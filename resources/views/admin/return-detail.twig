{% extends "Ceres::PageDesign.PageDesign" %}

{% block PageBody %}
<div class="container mt-4">
	<a href="/admin/returns" class="btn btn-sm btn-outline-secondary mb-3">Zur Übersicht</a>
	<h1 class="h3 mb-3">Rücksendung {{ return.return_number }}</h1>

	<div class="row g-3">
		<div class="col-lg-8">
			<div class="card mb-3">
				<div class="card-header">Details</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<p><strong>Status:</strong> {{ return.status }}</p>
							<p><strong>Kunde:</strong> {{ return.customer_name }} ({{ return.customer_email }})</p>
						</div>
						<div class="col-md-6">
							<p><strong>Bestellung:</strong> #{{ order.id }}</p>
							<p><strong>Erstellt:</strong> {{ return.created_at | date('d.m.Y H:i') }}</p>
						</div>
					</div>
				</div>
			</div>

			<div class="card">
				<div class="card-header">Artikel</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th>Produkt</th>
									<th>Menge</th>
									<th>Preis</th>
									<th>Grund</th>
								</tr>
							</thead>
							<tbody>
								{% for item in return.items %}
								<tr>
									<td>{{ item.item_name }}</td>
									<td>{{ item.quantity }}</td>
									<td>{{ item.price | number_format(2, ',', '.') }}</td>
									<td>{{ item.reason }}</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="card mb-3">
				<div class="card-header">Aktionen</div>
				<div class="card-body d-grid gap-2">
					{% for a in availableActions %}
						{% if a == 'approve' %}
							<form method="post" action="/admin/returns/{{ return.id }}/approve">
								<button class="btn btn-success w-100" type="submit">Genehmigen</button>
							</form>
						{% elseif a == 'reject' %}
							<form method="post" action="/admin/returns/{{ return.id }}/reject">
								<button class="btn btn-danger w-100" type="submit">Ablehnen</button>
							</form>
						{% elseif a == 'mark_received' %}
							<form method="post" action="/admin/returns/{{ return.id }}/receive">
								<button class="btn btn-primary w-100" type="submit">Als empfangen markieren</button>
							</form>
						{% elseif a == 'refund' %}
							<form method="post" action="/admin/returns/{{ return.id }}/refund">
								<button class="btn btn-outline-primary w-100" type="submit">Erstattung</button>
							</form>
						{% endif %}
					{% endfor %}
				</div>
			</div>

			<div class="card">
				<div class="card-header">Statusverlauf</div>
				<div class="card-body">
					{% if statusHistory is not empty %}
						<ul class="list-unstyled mb-0">
							{% for s in statusHistory %}
								<li class="mb-2">{{ s.timestamp }} – {{ s.status }} – {{ s.notes }}</li>
							{% endfor %}
						</ul>
					{% else %}
						<p class="text-muted mb-0">Keine Einträge.</p>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}


